<!DOCTYPE html>
<html>
<head>
<link href="https://fonts.googleapis.com/css?family=Play&display=swap" rel="stylesheet">
<link href='https://fonts.googleapis.com/css?family=Roboto:300' rel='stylesheet' type='text/css'>
<script src="https://code.jquery.com/jquery-3.4.1.js"></script>
<script src="https://ajax.googleapis.com/ajax/libs/jquery/3.4.1/jquery.min.js%22%3E"></script>
<meta charset="utf-8" />

<title>Cow Patty Bingo</title>
<link rel="stylesheet" type="text/css" href="style.css" />
<script type="text/javascript" src="gameJavascript.js"></script>
</head>
<body onload="newCard();">
  <div id="container">
    <div id="header">
      <img src="assets/boo_radley.png">
    </div>
  	<div id="content">
      <img id="cow" src="assets/cowWalk.gif" style="width:150px;height:100px;position:absolute;left:0;top:40"></img>
  		<table id="bingotable">
  			<tr id="row1">
  				<td id="square0">6</td>
  				<td id="square1">14</td>
  				<td id="square2">24</td>
  				<td id="square3">36</td>
  				<td id="square4">15</td>
          <td id="square5">22</td>
  			</tr>
        <tr id="row2">
  				<td id="square6">27</td>
  				<td id="square7">2</td>
  				<td id="square8">35</td>
  				<td id="square9">7</td>
  				<td id="square10">34</td>
          <td id="square11">5</td>
  			</tr>
        <tr id="row3">
  				<td id="square12">4</td>
  				<td id="square13">9</td>
  				<td id="square14">28</td>
  				<td id="square15">3</td>
  				<td id="square16">31</td>
          <td id="square17">23</td>
  			</tr>
        <tr id="row4">
  				<td id="square18">26</td>
  				<td id="square19">16</td>
  				<td id="square20">10</td>
  				<td id="square21">20</td>
  				<td id="square22">8</td>
          <td id="square23">30</td>
  			</tr>
        <tr id="row5">
  				<td id="square24">21</td>
  				<td id="square25">17</td>
  				<td id="square26">32</td>
  				<td id="square27">16</td>
  				<td id="square28">29</td>
          <td id="square29">25</td>
  			</tr>
        <tr id="row6">
  				<td id="square30">19</td>
  				<td id="square31">1</td>
  				<td id="square32">18</td>
  				<td id="square33">11</td>
  				<td id="square34">33</td>
          <td id="square35">12</td>
  			</tr>
  		</table>
      <button id="button">
        <a id="finished" href="http://localhost:8080/">Finished</a>
      </button>
  	</div>
  </div>

  <script type = "text/javascript">
          var cowImage = $("#cow");
          var imagePos = cowImage.position();
          var ogPosTop =  imagePos.top;
          var ogPosLeft = imagePos.left;
          var endPosTop = 400;
          var endPosLeft = 300;
          var cowPosTop = imagePos.top;
          var cowPosLeft = imagePos.left;

          var btmRightSqr = $("#square35");
          var btmRightSqrPos = btmRightSqr.position();
          var rightEdge = btmRightSqrPos.left;

          var winningTile = $("#square24");
          var cowWalkInterval;
          var cowLeaveInterval;
          var walkAimlessInterval = setInterval(walkAimlessly, 10);
          var goUp = false;
          var goDown = true;
          var goLeft = false;
          var goRight = false;
          var counter = 0;
          var gameId = "";
          $(document).ready(function()
          {         // /config/localStorageNames.gameId'?
              $.get("http://localhost:3030/admin/games/", function(gameId)
              {
                var currentGameId = gameId[0].count;
                gameId += currentGameId;
              });
              //"ObjectId(5cad0d1224e4fb95d455865b)"
              $.get("http://localhost:3030/admin/games/" + gameId, function(winningTile)
              {
                alert("winningTile: " + winningTile);
                winningTile = this.winningTile;
              });
          });
        //  var cowWalkingInterval = setInterval(cowWalking, 10);
         function walkAimlessly()
          {
            counter++;
            //Walks around in a circle
            if(goDown)
            {
              cowPosTop++;
              $("#cow").css('top', cowPosTop);
              if(cowPosTop > 600)
              {
                goDown = false;
                goUp = false;
                goLeft = false;
                goRight = true;
              }
              if((cowPosTop >= endPosTop) && (counter > 1000))
              {
                goDown = false;
                goUp = false;
                goLeft = false;
                goRight = false;
                $("#cow"). attr("src", "assets/cowWalk.gif");
                cowPosLeft = endPosLeft;
                cowPosTop = endPosTop;
                $("#cow").css('left', cowPosLeft);
                $("#cow").css('top', cowPosTop);
                cowWalkingInterval = setInterval(cowWalking, 10);
                clearInterval(walkAimlessInterval);
              }
            }
            if(goRight)
            {
              cowPosLeft++;
              $("#cow").css('left', cowPosLeft);
              if(cowPosLeft >= 1300)
              {
                goDown = false;
                goUp = true;
                goLeft = false;
                goRight = false;
              }
            }
            if(goUp)
            {
              cowPosTop--;
              $("#cow").css('top', cowPosTop);
              if(cowPosTop < 250)
              {
                goDown = false;
                goUp = false;
                goRight = false;
                goLeft = true;
              }
              }
              if(goLeft)
              {
                $("#cow"). attr("src", "assets/cowFlipped.gif");
                cowPosLeft--;
                $("#cow").css('left', cowPosLeft);
                if(cowPosLeft < endPosLeft)
                {
                  $("#cow"). attr("src", "assets/cowWalk.gif");
                  goDown = true;
                  goUp = false;
                  goLeft = false;
                  goRight = false;
                }

            }
         }
      function cowWalking()
      {
        //Check if winning tile is in row 1
          if(winningTile.is("#square0") || winningTile.is("#square1") || winningTile.is("#square2")
          || winningTile.is("#square3") || winningTile.is("#square4") || winningTile.is("#square5"))
          {
            cowPosLeft++;
            $("#cow").css('left', cowPosLeft);
            if(isOverlap("#cow", winningTile))
            {
                dropPattyOnTile();
            }
          }
          //Check if winning tile is in row 2
          if(winningTile.is("#square6") || winningTile.is("#square7") || winningTile.is("#square8")
          || winningTile.is("#square9") || winningTile.is("#square10") || winningTile.is("#square11"))
          {
            var keepMovingLeft = true;
            var keepMovingTop = false;
            if(keepMovingLeft)
            {
              cowPosLeft++;
              $("#cow").css('left', cowPosLeft);
              if(isOverlap("#cow","#square0"))
              {
                keepMovingTop = true;
                keepMovingLeft = false;
              }
              if(isOverlap("#cow", winningTile))
              {
                  dropPattyOnTile();
              }
            }
            if(keepMovingTop)
            {
              cowPosTop++;
              $("#cow").css('top', cowPosTop);
              if(isOverlap("#cow","#square6") && !winningTile.is("#square6"))
              {
                keepMovingTop = false;
                keepMovingLeft = true;
              }
            }
          }
          //Check if winning tile is in row 3
          if(winningTile.is("#square12") || winningTile.is("#square13") || winningTile.is("#square14")
          || winningTile.is("#square15") || winningTile.is("#square16") || winningTile.is("#square17"))
          {
            var keepMovingLeft = true;
            var keepMovingTop = false;
            if(keepMovingLeft)
            {
              cowPosLeft++;
              $("#cow").css('left', cowPosLeft);
              if(isOverlap("#cow","#square0"))
              {
                keepMovingTop = true;
                keepMovingLeft = false;
              }
              if(isOverlap("#cow", winningTile))
              {
                  dropPattyOnTile();
              }
            }
            if(keepMovingTop)
            {
              if(!isOverlap("#cow","#square12"))
              {
                cowPosTop++;
                $("#cow").css('top', cowPosTop);
              }
              if(isOverlap("#cow","#square12") && !winningTile.is("#square12"))
              {
                keepMovingTop = false;
                keepMovingLeft = true;
              }
              if(isOverlap("#cow","#square12") && winningTile.is("#square12"))
              {
                  dropPattyOnTile();
              }
            }
        }
        //Check if winning tile is in row 4
          if(winningTile.is("#square18") || winningTile.is("#square19") || winningTile.is("#square20")
          || winningTile.is("#square21") || winningTile.is("#square22") || winningTile.is("#square23"))
          {
            var keepMovingLeft = true;
            var keepMovingTop = false;
            if(keepMovingLeft)
            {
              cowPosLeft++;
              $("#cow").css('left', cowPosLeft);
              if(isOverlap("#cow","#square6"))
              {
                keepMovingTop = true;
                keepMovingLeft = false;
              }
              if(isOverlap("#cow", winningTile))
              {
                  dropPattyOnTile();
              }
            }
            if(keepMovingTop)
            {
              if(!isOverlap("#cow","#square18"))
              {
                cowPosTop++;
                $("#cow").css('top', cowPosTop);
              }
              if(isOverlap("#cow","#square19") && !winningTile.is("#square19"))
              {
                keepMovingTop = false;
                keepMovingLeft = true;
              }
              if(isOverlap("#cow","#square19") && winningTile.is("#square19"))
              {
                  dropPattyOnTile();
              }
            }
          }
          //Check if winning tile is in row 5
          if(winningTile.is("#square24") || winningTile.is("#square25") || winningTile.is("#square26")
          || winningTile.is("#square27") || winningTile.is("#square28") || winningTile.is("#square29"))
          {
            var keepMovingLeft = true;
            var keepMovingTop = false;
            if(keepMovingLeft)
            {
              cowPosLeft++;
              $("#cow").css('left', cowPosLeft);
              if(isOverlap("#cow","#square6"))
              {
                cowPosTop++;
                $("#cow").css('top', cowPosTop);
              }
              if(isOverlap("#cow","#square12"))
              {
                cowPosTop++;
                  $("#cow").css('top', cowPosTop);
              }
              if(isOverlap("#cow","#square18"))
              {
                  cowPosTop++;
                  $("#cow").css('top', cowPosTop);
                  keepMovingTop = true;
                  keepMovingLeft = false;
              }
              if(isOverlap("#cow", winningTile))
              {
                  dropPattyOnTile();
              }
            }
            if(keepMovingTop)
            {
              if(!isOverlap("#cow","#square24"))
              {
                cowPosTop++;
                $("#cow").css('top', cowPosTop);
              }
              if(isOverlap("#cow","#square24") && !winningTile.is("#square24"))
              {
                keepMovingTop = false;
                keepMovingLeft = true;
              }
              if(isOverlap("#cow","#square24") && winningTile.is("#square24"))
              {
                  dropPattyOnTile();
              }
            }
          }
          //Check if winning tile is  in  row 6
          if(winningTile.is("#square30") || winningTile.is("#square31") || winningTile.is("#square32")
          || winningTile.is("#square33") || winningTile.is("#square34") || winningTile.is("#square35"))
          {
            var keepMovingLeft = true;
            var keepMovingTop = false;
            if(keepMovingLeft)
            {
              cowPosLeft++;
              $("#cow").css('left', cowPosLeft);
              if(isOverlap("#cow","#square6"))
              {
                cowPosTop++;
                $("#cow").css('top', cowPosTop);
              }
              if(isOverlap("#cow","#square12"))
              {
                cowPosTop++;
                  $("#cow").css('top', cowPosTop);
              }
              if(isOverlap("#cow","#square18"))
              {
                  cowPosTop++;
                  $("#cow").css('top', cowPosTop);
                  keepMovingTop = true;
                  keepMovingLeft = false;
              }
              if(isOverlap("#cow","#square24"))
              {
                  cowPosTop++;
                  $("#cow").css('top', cowPosTop);
                  keepMovingTop = true;
                  keepMovingLeft = false;
              }
              if(isOverlap("#cow", winningTile))
              {
                  dropPattyOnTile();
              }
            }
            if(keepMovingTop)
            {
              if(!isOverlap("#cow","#square30"))
              {
                cowPosTop++;
                $("#cow").css('top', cowPosTop);
              }
              if(isOverlap("#cow","#square30") && !winningTile.is("#square30"))
              {
                keepMovingTop = false;
                keepMovingLeft = true;
              }
              if(isOverlap("#cow","#square30") && winningTile.is("#square30"))
              {
                  dropPattyOnTile();
              }
            }
         }
      }

      function dropPattyOnTile()
      {
        $("#cow"). attr("src", "assets/cow1.gif");
        clearInterval(cowWalkInterval);
        $("#cow"). attr("src", "assets/cowWalk.gif");
        setTimeout(function(){winningTile.css('background-color', '#4d2600'); }, 1000);
      }

      function isOverlap(idOne,idTwo)
      {
        var cow=$(idOne),
            square=$(idTwo),
            offsetCow = cow.offset(),
            offsetSquare = square.offset(),
            cowBottom= offsetCow.top,
            squareTop=offsetSquare.top,
            cowLeft=offsetCow.left,
            squareLeft=offsetSquare.left,
            cowWidth = cow.width(),
            squareWidth = square.width(),
            cowHeight = cow.height(),
            squareHeight = square.height();
       var leftTop = squareLeft > cowLeft && squareLeft < cowLeft+cowWidth && squareTop > cowBottom && squareTop < cowBottom+cowHeight,
        rightTop = squareLeft+squareWidth > cowLeft && squareLeft+squareWidth < cowLeft+cowWidth && squareTop > cowBottom && squareTop < cowBottom+cowHeight,
        leftBottom = squareLeft > cowLeft && squareLeft < cowLeft+cowWidth && squareTop+squareHeight > cowBottom && squareTop+squareHeight < cowBottom+cowHeight,rightBottom = squareLeft+squareWidth > cowLeft
        && squareLeft+squareWidth < cowLeft+cowWidth && squareTop+squareHeight > cowBottom && squareTop+squareHeight < cowBottom+cowHeight;
        return leftTop || leftBottom;
    }

    </script>
</body>

</html>
